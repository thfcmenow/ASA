<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AddSearch Admin</title>
    <link rel="stylesheet" href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src=https://code.jquery.com/jquery-3.6.1.js integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <h2>Local AddSearch Admin Tools</h2>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <input class="form-control" id="searchterm" placeholder="Search Term">
            </div>
            <div class="col-sm-3">
                <select id="lob" class="form-select" aria-label="Default select example">
                    <option value="" selected>Select LOB:</option>
                    <option value="2xjja.nsf^0xpalmettogba.com">JJ Part A</option>
                    <option value="2xjjb.nsf^0xpalmettogba.com">JJ Part B</option>
                    <option value="2xjma.nsf^0xpalmettogba.com">JM Part A</option>
                    <option value="2xjmb.nsf^0xpalmettogba.com">JM Part B</option>
                    <option value="2xjmhhh.nsf^0xpalmettogba.com">JM Home Health & Hospice</option>
                    <option value="2xrrb.nsf^0xpalmettogba.com">Railroad Beneficiaries</option>
                    <option value="2xrr.nsf^0xpalmettogba.com">Railroad Medicare</option>
                    <option value="2xmoldxv2.nsf^0xpalmettogba.com">MolDX</option>
                    <option value="2xdex.nsf^0xdexzcodes.com">DEX</option>
                    <option value="2xprior.nsf^0xpalmettogba.com">Prior Authorization</option>
                    <option value="2xpdac.nsf^0xdmedpac.com">PDAC</option>
                    <option value="2xcsscw3.nsf^0xcsscoperations.com">CSSC Operations</option>
                    <option value="2xtpaw3.nsf^0xtpadministrator.com">TPA Administrator</option>
                </select>
            </div>
            <div class="col-sm-1">
                <select id="count" class="form-select" aria-label="Default select example">
                    <option value="5">5</option>
                    <option value="20">20</option>
                    <option value="40">40</option>
                    <option value="100">100</option>
                </select>
            </div>
            <div class="col-sm-2">
                <input class="form-control" id="password" placeholder="Password">
            </div>
            <div class="col-sm-1">
                <button class="btn btn-secondary" id="search">Search</button>
            </div>
            <div class="col-sm-1">
                <button style="display:none" class="btn btn-secondary" id="more">More</button>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <table class="table" style="display:none">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="results">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
<!-- local script -->
<script>
    var main = ""
    highlightFail = false
    $("input").css("border-color","ced4da")
    $("input").css("background-color","white")
    if (localStorage.getItem("pass") !== "") {
        $("#password").val(localStorage.getItem("pass"))
    }
    highlight = (obj,major) => {
        highlightFail = true
        obj.css("border-color","red")
        if (major) {
            obj.css("background-color","yellow")
            $("#search").html("Locked")
        }
    }
    deleteMe = (id) => {
        let sure = confirm("Are you Sure?")
        if (sure) {
            $("#" + id).fadeOut(500)
            //  $.get("/delete", { id: id, pass: $("#password").val() }, function (res) {
            //      console.log(res)
            // })
        }
    }
    renderResults = (main) => {
        let build = ""
        if (main[0].hasOwnProperty("password")) {
            highlight($("#password"),true)
            return false
        }
        main.forEach(function (item) {
            console.log(item.allinfo)
            build += "<tr id='" + item.id + "'>"
            build += "<td><a href='" + item.url + "' target='_blank'>" + item.title + "</a>"
            build += "<table><tr><td><div class='alert alert-secondary'>"
            if (item.allinfo.hasOwnProperty("custom_fields")) {
                for (const key in item.allinfo.custom_fields) {
                    build += "<p>" + `${key}: ${item.allinfo.custom_fields[key]}` + "</p>"
                }
            }
            build += "</div></td></tr></table>"
            build += "</td>"
            build += "<td>" + item.id + "</td>"
            build += "<td><button class='btn btn-warning' onclick='deleteMe(\"" + item.id + "\")'>Delete</button></td>"
            build += "</tr>"
        })
        $("#more").show()
        $("#results").prepend(build)
        $(".table").show()
        $("#search").html("Search")
        $("#search").attr("disabled", false)
    }
    $("#more").click(function(){
        $(".alert-secondary").length == 0 ? $(".alert-secondary").show() : $(".alert-secondary").hide()
    })
    $("#search").click(function () {
        highlightFail = false
        $("input").css("border-color","ced4da")
        if ($("#password").val() !=="") {
            localStorage.setItem('pass', $("#password").val());
        } else {
            highlight($("#password"))
        }
        let thisISanID = false
        let input = $("#searchterm").val()
        input.replace(/ /g, "").length == 32 ? thisISanID = true : ""
        console.log(thisISanID)
        let lob = $("#lob").val()
        if (input == "") {
            highlight($("#searchterm"))
        }
        if (!thisISanID) {
            if (lob == "") {
                highlight($("#lob"))
            }
        }
        if (highlightFail) return false
        $("input").css("border-color","ced4da")
        $(this).html("Wait")
        $(this).attr("disabled", true)
        $("#results").html("")
        if (thisISanID) {
            $.get("/idonly", { id: input, pass: $("#password").val() }, function (res) {
                main = JSON.parse("[" + res + "]")
                renderResults(main)
            })
        } else {
            $.get("/info", { main: input, filename: lob, count: $("#count").val(), pass: $("#password").val() }, function (res) {
                main = JSON.parse("[" + res + "]")
                console.log(main)
                renderResults(main)
            })
        }
    })
</script>
<!-- local css-->
<style>
    .container {
        margin-top: 20px
    }

    .row {
        margin-top: 10px
    }

    .alert p {
        margin: 0.2px 0.2px 0.2px 0.2px;
        font-size: 0.7em
    }

    .alert-secondary {
        background-color: #fcfdff !important;
        margin-top: 8px !important;
        display: none;
        width: 600px;
        max-width: 600px
    }
</style>

</html>
